.icon-canvas-block {

    width: 100%;
    height: 100%;

    // Dot stanzas and nav need to hide overflow, popup buttons need to show.
    .button:not(.overflow-shown)
    & {
        overflow: hidden;
    }

    // Necessary?
    .single-book-column
    & {
        transition: width @animation-default;
    }

    .dots-toggle-block
    &,
    .verse-audio-button-block
    & {        
        // Override default.
        overflow: visible;
    }

    /**
     * All dot backgrounds in lyrics and annotation cards, except portal
     * annotation cards.
     */
    .text-anchor-block
    &,
    .annotation-card:not(.portal)
    & {
        // Fade out first, then reduce width.
        transition: opacity @animation-default,
                    width @animation-default @animation-faster;
        width: 0;
        opacity: 0;
    }

    .button.enabled
    & {
        transition: background-color @animation-default,
        transform @animation-instant;

        // Animate container itself, because its overflow is hidden.
        &:hover {
            animation: bounceHover @animation-default;
        }

        &:active {
            transform: scale(0.9);
        }
    }
}

.icon-canvas {
    border-radius: 50%;
    background-color: @button-disabled-colour;
    box-sizing: border-box;

    // Don't add colour to dot toggle button that is deselected.
    .dot:not(.dot-stanza-button):not(.deselected)
    & {
        &.portal { background-color: @portal-dot-colour; }
        &.observation { background-color: @observation-dot-colour; }
        &.backstory { background-color: @backstory-dot-colour; }
        &.reference { background-color: @reference-dot-colour; }
        &.pun { background-color: @pun-dot-colour; }
        &.narrative { background-color: @narrative-dot-colour; }
        &.songwriting { background-color: @songwriting-dot-colour; }
        &.afterword { background-color: @afterword-dot-colour; }
    }

    .carousel-nav-buttons-block
    & {
        background-color: #d84;
    }

    .carousel-toggle-button
    & {
        background-color: #dfe;
    }

    .custom-shape
    & {
        border-radius: 0;
    }

    .dots-toggle-button-block
    & {
        background-color: purple;
    }

    .lyric-button-block
    & {
        background-color: orange;
    }

    .nav-button
    & {
        background-color: #dd8;
    }

    .nav-button.selected
    & {
        background-color: orange;
    }

    .overview-toggle-button-container
    & {
        background-color: #d84;
    }

    .TitleToggle
    & {
        background-color: #d88;
    }

    .PopupButton
    & {
        box-shadow: @PopupButton-box-shadow;
    }

    .PopupButton.close-position
    & {
        background-color: #fdd;
    }

    .PopupButton.side-position
    & {
        background-color: #dfd;
    }

    .anchor-block
    & {
        border: @dot-border solid @lyric-underline-enabled-colour;
    }

    .annotation-card
    .dots-block
    & {
        width: @annotation-dot-diameter;
        border: @dot-border solid @dot-border-colour;
    }

    .text-anchor-block
    & {
        width: @lyric-anchor-dot-diameter;
    }
}

// Portals are not included here.
.domManager.narrative .annotation-card .icon-canvas-block.narrative,
.domManager.backstory .annotation-card .icon-canvas-block.backstory,
.domManager.observation .annotation-card .icon-canvas-block.observation,
.domManager.pun .annotation-card .icon-canvas-block.pun,
.domManager.reference .annotation-card .icon-canvas-block.reference,
.domManager.songwriting .annotation-card .icon-canvas-block.songwriting,
.domManager.afterword .annotation-card .icon-canvas-block.afterword {
    // Increase width first, then fade in.
    transition: width @animation-default,
                opacity @animation-default @animation-faster;
    width: @annotation-dot-diameter;
    opacity: 1;
}

// Default styling. Should not be visible when slider is not moving.
.domManager.slider-not-moving.narrative .text-anchor-block .icon-canvas-block.narrative,
.domManager.slider-not-moving.backstory .text-anchor-block .icon-canvas-block.backstory,
.domManager.slider-not-moving.observation .text-anchor-block .icon-canvas-block.observation,
.domManager.slider-not-moving.pun .text-anchor-block .icon-canvas-block.pun,
.domManager.slider-not-moving.reference .text-anchor-block .icon-canvas-block.reference,
.domManager.slider-not-moving.songwriting .text-anchor-block .icon-canvas-block.songwriting,
.domManager.slider-not-moving.portal .text-anchor-block .icon-canvas-block.portal,
.domManager.slider-not-moving.afterword .text-anchor-block .icon-canvas-block.afterword {
    // Increase width first, then fade in.
    transition: width @animation-default,
                opacity @animation-default @animation-faster;
    width: @lyric-anchor-dot-diameter;
    opacity: 1;
}

// Hover styling.
.domManager.narrative .text-anchor-block:hover .icon-canvas-block.narrative,
.domManager.backstory .text-anchor-block:hover .icon-canvas-block.backstory,
.domManager.observation .text-anchor-block:hover .icon-canvas-block.observation,
.domManager.pun .text-anchor-block:hover .icon-canvas-block.pun,
.domManager.reference .text-anchor-block:hover .icon-canvas-block.reference,
.domManager.songwriting .text-anchor-block:hover .icon-canvas-block.songwriting,
.domManager.portal .text-anchor-block:hover .icon-canvas-block.portal,
.domManager.afterword .text-anchor-block:hover .icon-canvas-block.afterword {
   animation: bounceHover @animation-slow;
}

// Active styling.
.domManager.narrative .text-anchor-block:active .icon-canvas-block.narrative,
.domManager.backstory .text-anchor-block:active .icon-canvas-block.backstory,
.domManager.observation .text-anchor-block:active .icon-canvas-block.observation,
.domManager.pun .text-anchor-block:active .icon-canvas-block.pun,
.domManager.reference .text-anchor-block:active .icon-canvas-block.reference,
.domManager.songwriting .text-anchor-block:active .icon-canvas-block.songwriting,
.domManager.portal .text-anchor-block:active .icon-canvas-block.portal,
.domManager.afterword .text-anchor-block:active .icon-canvas-block.afterword {
   transform: scale(0.8);
}
