.overlay-popup-subfield {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;

    // Prevent lyric scrolling from pushing app offscreen.
    overflow: hidden;

    // Centre the audio section.
    display: flex;
    flex-direction: column;
    align-items: center;

    .overlay-popup-block {
        position: relative;
        width: 100%;
        flex-grow: 1;
    }

    .popup-content-wrapper {
        box-sizing: border-box;

        &.annotation {
            box-shadow: @popup-box-shadow;
        }

        &.score, &.wiki {
            box-shadow: @popup-darker-box-shadow;
        }
    }

    /**
     * Some duplication of animation values here. The audio popup animation
     * works when it's applied to the subfield, not the popup-wrapper. I'm too
     * lazy to investigate the reason why.
     */
    .audio-subfield {
        z-index: @audio-in-overlay-z-index;
        width: 100%;

        box-shadow: @popup-darker-box-shadow;

        animation: overlaidPopupOut 0.3s;
        opacity: 0;
        transform: scale(1.3);
    }

    .audio-section {
        height: @menu-height;
    }
}

.is-desktop, .tablet-width {
    /**
     * In desktop and tablet, width of audio subfield in overlay is less than
     * width of screen.
     */
    .overlay-popup-subfield {
        .audio-subfield {
            overflow: hidden;
            border-radius: 15px;
        }
    }
}

.overlaid-annotation {
    .overlay-popup-subfield {
        .popup-content-wrapper {
            &.annotation {
                box-shadow: @popup-darker-box-shadow;
            }
        }
    }

    .popup-button-block {
        &.side-position {
            top: 50%;
            transform: translateY(-50%);
        }

        &.shadow {
            box-shadow: @popup-darker-box-shadow;
        }
    }
}

.timer-in-audio {
    .overlay-popup-subfield {

        @banner-margin: 5px;

        .audio-section {
            align-items: flex-start;
            height: @app-icon-diameter * 2 + @banner-margin;
        }

        .audio-buttons-block, .audio-timer-block, .audio-banner-block {
            height: @app-icon-diameter;
        }

        .audio-buttons-block {
            max-width: 300px; // Also arbitrary.
        }

        .audio-timer-block {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: @audio-block-padding;

            font-size: 1.75em;
        }

        .audio-banner-block {
            position: absolute;
            bottom: 0;
            width: 100%;
        }

        .audio-display-block {
            display: none;
        }
    }
}

.overlay-shown {
    .menu-field {
        top: -@menu-height;
    }

    .audio-banner-custom-subfield {
        top: -@menu-height - @audio-banner-custom-subfield-height - 2 * @audio-banner-custom-subfield-padding;
    }

    .overlay-popup-subfield {
        .audio-subfield {
            animation: overlaidPopupIn 0.3s;
            opacity: 1;
            transform: scale(1);
        }
    }
}

.tablet-width {
    .overlay-shown {
        .nav-custom-subfield {
            top: -@nav-tablet-height - @menu-height;
        }
    }
}


.mini-width {
    .overlay-shown {
        .nav-custom-subfield {
            top: -@nav-mini-height - @menu-height;
        }
    }
}
